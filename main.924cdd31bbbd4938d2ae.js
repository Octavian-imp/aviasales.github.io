(()=>{"use strict";var e,t,r,a={9046:(e,t,r)=>{var a=r(3696),s=r(7470),n=r(2893),c=r(4104),l=r(1799),i=r(6940);const o="__app___Cl7TI",u="__contentPage___dsqmK";var p=r(916),m=r(5238),d=r(910),f=r(9842);class h{static imgUrl="//pics.avs.io/99/36";static baseUrl="https://aviasales-test-api.kata.academy";static async fetchTickets(e,t){let{sort:r,transplants:a}=t,s=[];const n=await async function t(){try{const t=await fetch(h.baseUrl+"/tickets?searchId="+e).then((e=>e.json()));return t.stop||(s=[...s,...t.tickets]),t.stop}catch(e){return await t(),!1}}();return{tickets:s,stop:n}}static applyFilters(e,t){let{transplants:r,sort:a}=t;const s=this.filterTickets(e,r);return this.sortTickets(s,a)}static sortTickets(e,t){switch(t){case"cheap":e.sort(((e,t)=>e.price-t.price));break;case"fast":e.sort(((e,t)=>e.segments.reduce(((e,t)=>e+t.duration),0)-t.segments.reduce(((e,t)=>e+t.duration),0)))}return e}static filterTickets(e,t){return t.length>0&&(e=e.filter((e=>e.segments.some((e=>t.some((t=>e.stops.length===t))))))),[...e]}static async fetchSearchId(){return await fetch(this.baseUrl+"/search").then((e=>e.json()))}}var g=r(5022);const y=g.d4.withTypes(),_=g.wA.withTypes(),k=(g.Pj.withTypes(),f.zD.withTypes()),v=k("options/fetchSearchId",(async()=>await h.fetchSearchId())),E=e=>e.options,b=(0,d.Mz)(E,(e=>e.searchId)),T=(0,d.Mz)(E,(e=>e.filterTransplants)),w=(0,d.Mz)(E,(e=>e.sortedBy)),A=(0,f.Z0)({name:"options",initialState:{filterTransplants:[],sortedBy:"fast",searchId:"",limit:50},reducers:{setFilterTransplants(e,t){e.filterTransplants=t.payload},setSortedBy(e,t){e.sortedBy=t.payload},setLimit(e,t){e.limit=t.payload}},extraReducers:e=>e.addCase(v.fulfilled,((e,t)=>({...e,searchId:t.payload.searchId})))}),{setFilterTransplants:C,setSortedBy:O,setLimit:j}=A.actions,S=A,x=e=>e.tickets,N=(0,d.Mz)(x,(e=>e.originTickets)),F=k("tickets/fetchTickets",(async(e,t)=>{const r=t.getState(),a=T(r),s=w(r),n=b(r);return await h.fetchTickets(n,{sort:s,transplants:a})})),I=k("tickets/applyFilters",(async(e,t)=>{const r=t.getState(),a=T(r),s=w(r),n=N(r);return h.applyFilters(n,{sort:s,transplants:a})})),P=(0,f.Z0)({name:"tickets",initialState:{status:"pending",tickets:[],stop:!1,originTickets:[]},reducers:{getTickets:e=>e},extraReducers:e=>e.addCase(F.pending,(e=>({...e,status:"pending"}))).addCase(F.fulfilled,((e,t)=>{const r=e.tickets.length>0?[...e.tickets,...t.payload.tickets]:t.payload.tickets;return{...e,status:"fulfilled",originTickets:r,tickets:r,stop:t.payload.stop}})).addCase(F.rejected,(e=>({...e,status:"rejected"}))).addCase(I.fulfilled,((e,t)=>({...e,tickets:t.payload})))}),{getTickets:z}=P.actions,M=P,B="Filter__container___Z2QvX",U="Filter__title___nCzzG",G="Filter__checkboxGroup___F_XrL",R=p.A.Group,D=[{label:"Без пересадок",value:0},{label:"1 пересадка",value:1},{label:"2 пересадки",value:2},{label:"3 пересадки",value:3}],$=()=>{const e=_(),{originTickets:t}=y(x),r=y((e=>e.options.filterTransplants)),s=D.length===r.length,n=r.length>0&&r.length<D.length;(0,a.useEffect)((()=>{e(I())}),[t.length]);const l=t=>{e(C(t)),e(I())};return a.createElement(c.A,{vertical:!0,className:B},a.createElement(m.A,{level:5,className:U},"количество пересадок"),a.createElement(c.A,{vertical:!0},a.createElement(p.A,{indeterminate:n,onChange:e=>{const t=e.target.checked?D.map((e=>e.value)):[];l(t)},checked:s},"Все"),a.createElement(R,{rootClassName:G,prefixCls:"checkbox",options:D,value:r,onChange:l})))};var H=r(9030);const L=[{label:"Самый дешевый",value:"cheap"},{label:"Самый быстрый",value:"fast"},{label:"Оптимальный",value:"optimal"}],Z=()=>{const e=_(),t=y(w),{originTickets:r}=y(x);return(0,a.useEffect)((()=>{e(I())}),[r.length]),a.createElement(H.Ay.Group,{block:!0,defaultValue:t,options:L,optionType:"button",buttonStyle:"solid",style:{whiteSpace:"nowrap",width:"100%",textTransform:"uppercase"},onChange:t=>{e(O(t.target.value)),e(I())}})};var q=r(4489),K=r(706),V=r(8448),X=r(4401),Y=r(856),Q=r(9589),W=r(2434),J=r(5849),ee=r(5453),te=r(2604);const re="TicketCard__container___EW9Rw",ae="TicketCard__cost___zxwE_",se="TicketCard__imgCompany___cHY86",ne="TicketCard__descriptionTitle___gpb9x",ce="TicketCard__time___o_m8E",le=e=>{let{price:t,carrier:r,segments:s}=e;return a.createElement(c.A,{vertical:!0,gap:20,className:re},a.createElement(c.A,{justify:"space-between",align:"center"},a.createElement("span",{className:ae},Intl.NumberFormat("ru",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(t)),a.createElement(l.A,{className:se,preview:!1,height:30,src:`${h.imgUrl}/${r}.png`})),s.map((e=>a.createElement(le.SegmentTicket,{key:(0,X.A)(),value:{...e}}))))};le.SegmentTicket=e=>{let{value:{date:t,destination:r,duration:s,origin:n,stops:c}}=e;const l=Date.parse(t),i=(0,W.z)(Date.parse(t),s);return a.createElement(Y.A,null,a.createElement(Q.A,{flex:1},a.createElement(Y.A,{className:ne},n," - ",r),a.createElement(Y.A,{className:ce},(0,J.GP)(t,"hh:mm")," - ",(0,J.GP)(i,"hh:mm"))),a.createElement(Q.A,{flex:1},a.createElement(Y.A,{className:ne},"В пути"),a.createElement(Y.A,{className:ce},"~",(0,ee.k)(l,i,{locale:te.ru,unit:"hour"}))),a.createElement(Q.A,{flex:1},a.createElement(Y.A,{className:ne},c.length>1?`${c.length} пересадки`:1===c.length?`${c.length} пересадка`:"Без пересадок"),a.createElement(Y.A,{className:ce},c.map(((e,t)=>t===c.length-1?e:e+", ")))))};const ie=le,oe=()=>{const{tickets:e,status:t}=y(x),{filterTransplants:r,sortedBy:s,limit:n}=y(E),c=_(),[l,i]=(0,a.useState)(e.slice(0,10)),o=(0,a.useDeferredValue)(l);return(0,a.useEffect)((()=>{i(e.slice(0,10)),j(10)}),[e,r,s]),"rejected"===t?a.createElement(q.A,{message:"Error",type:"error",onClick:()=>c(F()),action:a.createElement(K.Ay,null,"Повторить запрос")}):0===o.length?a.createElement(q.A,{message:"Ничего не найдено",type:"info"}):a.createElement(a.Fragment,null,"pending"===t&&a.createElement(V.A,{size:"large"}),o.map((e=>a.createElement(ie,{key:(0,X.A)(),price:e.price,carrier:e.carrier,segments:e.segments}))),a.createElement(K.Ay,{type:"primary",onClick:function(){const t=n+10;i((r=>[...r,...e.slice(n,t)])),c(j(t)),t>=e.length&&c(F())}},"Загрузить еще ",10," билетов"))},ue=e=>{const t=(0,a.useRef)(!1);(0,a.useEffect)((()=>{t.current||(t.current=!0,e())}),[])},pe=()=>{const e=_(),{stop:t}=y(x),r=(0,a.useRef)();(0,a.useEffect)((()=>{t&&r.current&&(console.log("stop"),clearInterval(r.current))}),[t]);return ue((()=>{r.current=setInterval((()=>{e(F())}),500),(async()=>{try{await e(v()),await e(F())}catch(e){console.log(e)}})()})),a.createElement(n.Ay,{theme:{hashed:!1}},a.createElement(c.A,{className:o},a.createElement(l.A,{src:"./assets/img/logo.png",height:60,width:60,preview:!1}),a.createElement(i.UC,{className:u},a.createElement($,null),a.createElement(c.A,{vertical:!0,gap:20,style:{width:"100%"}},a.createElement(Z,null),a.createElement(oe,null)))))};const me=(0,r(2446).HY)({tickets:M.reducer,options:S.reducer}),de=(0,f.U1)({reducer:me}),fe=e=>{let{children:t}=e;return a.createElement(g.Kq,{store:de},t)};(0,s.H)(document.getElementById("root")).render(a.createElement(a.StrictMode,null,a.createElement(fe,null,a.createElement(pe,null))))}},s={};function n(e){var t=s[e];if(void 0!==t)return t.exports;var r=s[e]={exports:{}};return a[e](r,r.exports,n),r.exports}n.m=a,e=[],n.O=(t,r,a,s)=>{if(!r){var c=1/0;for(u=0;u<e.length;u++){r=e[u][0],a=e[u][1],s=e[u][2];for(var l=!0,i=0;i<r.length;i++)(!1&s||c>=s)&&Object.keys(n.O).every((e=>n.O[e](r[i])))?r.splice(i--,1):(l=!1,s<c&&(c=s));if(l){e.splice(u--,1);var o=a();void 0!==o&&(t=o)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[r,a,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},r=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(e,a){if(1&a&&(e=this(e)),8&a)return e;if("object"==typeof e&&e){if(4&a&&e.__esModule)return e;if(16&a&&"function"==typeof e.then)return e}var s=Object.create(null);n.r(s);var c={};t=t||[null,r({}),r([]),r(r)];for(var l=2&a&&e;"object"==typeof l&&!~t.indexOf(l);l=r(l))Object.getOwnPropertyNames(l).forEach((t=>c[t]=()=>e[t]));return c.default=()=>e,n.d(s,c),s},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,r)=>{var a,s,c=r[0],l=r[1],i=r[2],o=0;if(c.some((t=>0!==e[t]))){for(a in l)n.o(l,a)&&(n.m[a]=l[a]);if(i)var u=i(n)}for(t&&t(r);o<c.length;o++)s=c[o],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},r=self.webpackChunk=self.webpackChunk||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.O(void 0,[964],(()=>n(1001)));var c=n.O(void 0,[964],(()=>n(9046)));c=n.O(c)})();