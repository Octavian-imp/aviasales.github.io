(()=>{"use strict";var e,t,a,r={9046:(e,t,a)=>{var r=a(3696),s=a(7470),n=a(2893),l=a(4104),c=a(1799),i=a(6940);const o="__app___Cl7TI",u="__contentPage___dsqmK";var p=a(916),m=a(5238),d=a(910),h=a(9842);class f{static imgUrl="//pics.avs.io/99/36";static baseUrl="https://aviasales-test-api.kata.academy";static async fetchTickets(e,t){let{sort:a,transplants:r}=t,s=[];const n=await async function t(){try{const a=await fetch(f.baseUrl+"/tickets?searchId="+e).then((e=>e.json()));return!!a.stop||(s=[...s,...a.tickets],await t(),!1)}catch(e){return await t(),!1}}();return{tickets:s,stop:n}}static applyFilters(e,t){let{transplants:a,sort:r}=t;const s=this.filterTickets(e,a);return this.sortTickets(s,r)}static sortTickets(e,t){switch(t){case"cheap":e.sort(((e,t)=>e.price-t.price));break;case"fast":e.sort(((e,t)=>e.segments.reduce(((e,t)=>e+t.duration),0)-t.segments.reduce(((e,t)=>e+t.duration),0)))}return e}static filterTickets(e,t){return t.length>0&&(e=e.filter((e=>e.segments.some((e=>t.some((t=>e.stops.length===t))))))),[...e]}static async fetchSearchId(){return await fetch(this.baseUrl+"/search").then((e=>e.json()))}}var g=a(5022);const y=g.d4.withTypes(),_=g.wA.withTypes(),k=(g.Pj.withTypes(),h.zD.withTypes()),v=k("options/fetchSearchId",(async()=>await f.fetchSearchId())),E=e=>e.options,b=(0,d.Mz)(E,(e=>e.searchId)),T=(0,d.Mz)(E,(e=>e.filterTransplants)),w=(0,d.Mz)(E,(e=>e.sortedBy)),A=(0,h.Z0)({name:"options",initialState:{filterTransplants:[],sortedBy:"fast",searchId:"",limit:50},reducers:{setFilterTransplants(e,t){e.filterTransplants=t.payload},setSortedBy(e,t){e.sortedBy=t.payload},setLimit(e,t){e.limit=t.payload}},extraReducers:e=>e.addCase(v.fulfilled,((e,t)=>({...e,searchId:t.payload.searchId})))}),{setFilterTransplants:C,setSortedBy:O,setLimit:j}=A.actions,S=A,x=e=>e.tickets,N=(0,d.Mz)(x,(e=>e.originTickets)),F=k("tickets/fetchTickets",(async(e,t)=>{const a=t.getState(),r=T(a),s=w(a),n=b(a),l=await f.fetchTickets(n,{sort:s,transplants:r});return console.log(l.tickets.length),l})),I=k("tickets/applyFilters",(async(e,t)=>{const a=t.getState(),r=T(a),s=w(a),n=N(a);return f.applyFilters(n,{sort:s,transplants:r})})),P=(0,h.Z0)({name:"tickets",initialState:{status:"pending",tickets:[],stop:!1,originTickets:[]},reducers:{getTickets:e=>e},extraReducers:e=>e.addCase(F.pending,(e=>({...e,status:"pending"}))).addCase(F.fulfilled,((e,t)=>{const a=e.tickets.length>0?[...e.tickets,...t.payload.tickets]:t.payload.tickets;return{...e,status:"fulfilled",originTickets:a,tickets:a,stop:t.payload.stop}})).addCase(F.rejected,(e=>({...e,status:"rejected"}))).addCase(I.fulfilled,((e,t)=>({...e,tickets:t.payload})))}),{getTickets:z}=P.actions,M=P,B="Filter__container___Z2QvX",U="Filter__title___nCzzG",G="Filter__checkboxGroup___F_XrL",D=p.A.Group,R=[{label:"Без пересадок",value:0},{label:"1 пересадка",value:1},{label:"2 пересадки",value:2},{label:"3 пересадки",value:3}],$=()=>{const e=_(),t=y((e=>e.options.filterTransplants)),a=R.length===t.length,s=t.length>0&&t.length<R.length,n=t=>{e(C(t)),e(I())};return r.createElement(l.A,{vertical:!0,className:B},r.createElement(m.A,{level:5,className:U},"количество пересадок"),r.createElement(l.A,{vertical:!0},r.createElement(p.A,{indeterminate:s,onChange:e=>{const t=e.target.checked?R.map((e=>e.value)):[];n(t)},checked:a},"Все"),r.createElement(D,{rootClassName:G,prefixCls:"checkbox",options:R,value:t,onChange:n})))};var H=a(9030);const L=[{label:"Самый дешевый",value:"cheap"},{label:"Самый быстрый",value:"fast"},{label:"Оптимальный",value:"optimal"}],Z=()=>{const e=_(),t=y(w);return r.createElement(H.Ay.Group,{block:!0,defaultValue:t,options:L,optionType:"button",buttonStyle:"solid",style:{whiteSpace:"nowrap",width:"100%",textTransform:"uppercase"},onChange:t=>{e(O(t.target.value)),e(I())}})};var q=a(8448),K=a(4489),V=a(706),X=a(4401),Y=a(856),Q=a(9589),W=a(2434),J=a(5849),ee=a(5453),te=a(2604);const ae="TicketCard__container___EW9Rw",re="TicketCard__cost___zxwE_",se="TicketCard__imgCompany___cHY86",ne="TicketCard__descriptionTitle___gpb9x",le="TicketCard__time___o_m8E",ce=e=>{let{price:t,carrier:a,segments:s}=e;return r.createElement(l.A,{vertical:!0,gap:20,className:ae},r.createElement(l.A,{justify:"space-between",align:"center"},r.createElement("span",{className:re},Intl.NumberFormat("ru",{style:"currency",currency:"RUB",maximumFractionDigits:0}).format(t)),r.createElement(c.A,{className:se,preview:!1,height:30,src:`${f.imgUrl}/${a}.png`})),s.map((e=>r.createElement(ce.SegmentTicket,{key:(0,X.A)(),value:{...e}}))))};ce.SegmentTicket=e=>{let{value:{date:t,destination:a,duration:s,origin:n,stops:l}}=e;const c=Date.parse(t),i=(0,W.z)(Date.parse(t),s);return r.createElement(Y.A,null,r.createElement(Q.A,{flex:1},r.createElement(Y.A,{className:ne},n," - ",a),r.createElement(Y.A,{className:le},(0,J.GP)(t,"hh:mm")," - ",(0,J.GP)(i,"hh:mm"))),r.createElement(Q.A,{flex:1},r.createElement(Y.A,{className:ne},"В пути"),r.createElement(Y.A,{className:le},"~",(0,ee.k)(c,i,{locale:te.ru,unit:"hour"}))),r.createElement(Q.A,{flex:1},r.createElement(Y.A,{className:ne},l.length>1?`${l.length} пересадки`:1===l.length?`${l.length} пересадка`:"Без пересадок"),r.createElement(Y.A,{className:le},l.map(((e,t)=>t===l.length-1?e:e+", ")))))};const ie=ce,oe=()=>{const{tickets:e,status:t}=y(x),{filterTransplants:a,sortedBy:s,limit:n}=y(E),l=_(),[c,i]=(0,r.useState)(e.slice(0,10)),o=(0,r.useDeferredValue)(c);return(0,r.useEffect)((()=>{i(e.slice(0,10)),j(10)}),[e,a,s]),"pending"===t?r.createElement(q.A,{size:"large"}):"rejected"===t?r.createElement(K.A,{message:"Error",type:"error",onClick:()=>l(F()),action:r.createElement(V.Ay,null,"Повторить запрос")}):r.createElement(r.Fragment,null,o.map((e=>r.createElement(ie,{key:(0,X.A)(),price:e.price,carrier:e.carrier,segments:e.segments}))),r.createElement(V.Ay,{type:"primary",onClick:function(){const t=n+10;i((a=>[...a,...e.slice(n,t)])),l(j(t)),t>=e.length&&l(F())}},"Загрузить еще ",10," билетов"))},ue=e=>{const t=(0,r.useRef)(!1);(0,r.useEffect)((()=>{t.current||(t.current=!0,e())}),[])},pe=()=>{const e=_();return ue((()=>{(async()=>{try{await e(v()),await e(F())}catch(e){console.log(e)}})()})),r.createElement(n.Ay,{theme:{hashed:!1}},r.createElement(l.A,{className:o},r.createElement(c.A,{src:"./assets/img/logo.png",height:60,width:60,preview:!1}),r.createElement(i.UC,{className:u},r.createElement($,null),r.createElement(l.A,{vertical:!0,gap:20,style:{width:"100%"}},r.createElement(Z,null),r.createElement(oe,null)))))};const me=(0,a(2446).HY)({tickets:M.reducer,options:S.reducer}),de=(0,h.U1)({reducer:me}),he=e=>{let{children:t}=e;return r.createElement(g.Kq,{store:de},t)};(0,s.H)(document.getElementById("root")).render(r.createElement(r.StrictMode,null,r.createElement(he,null,r.createElement(pe,null))))}},s={};function n(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={exports:{}};return r[e](a,a.exports,n),a.exports}n.m=r,e=[],n.O=(t,a,r,s)=>{if(!a){var l=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],s=e[u][2];for(var c=!0,i=0;i<a.length;i++)(!1&s||l>=s)&&Object.keys(n.O).every((e=>n.O[e](a[i])))?a.splice(i--,1):(c=!1,s<l&&(l=s));if(c){e.splice(u--,1);var o=r();void 0!==o&&(t=o)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,r,s]},n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},a=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,n.t=function(e,r){if(1&r&&(e=this(e)),8&r)return e;if("object"==typeof e&&e){if(4&r&&e.__esModule)return e;if(16&r&&"function"==typeof e.then)return e}var s=Object.create(null);n.r(s);var l={};t=t||[null,a({}),a([]),a(a)];for(var c=2&r&&e;"object"==typeof c&&!~t.indexOf(c);c=a(c))Object.getOwnPropertyNames(c).forEach((t=>l[t]=()=>e[t]));return l.default=()=>e,n.d(s,l),s},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={792:0};n.O.j=t=>0===e[t];var t=(t,a)=>{var r,s,l=a[0],c=a[1],i=a[2],o=0;if(l.some((t=>0!==e[t]))){for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(i)var u=i(n)}for(t&&t(a);o<l.length;o++)s=l[o],n.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return n.O(u)},a=self.webpackChunk=self.webpackChunk||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})(),n.O(void 0,[964],(()=>n(1001)));var l=n.O(void 0,[964],(()=>n(9046)));l=n.O(l)})();